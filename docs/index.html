<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <body>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha384-1H217gwSVyLSIfaLxHbE7dRb3v4mYCKbpQvzx0cegeju1MVsGrX5xXxAvs/HgeFs" crossorigin="anonymous"></script>
  <form id="myForm"> 
  <label for="MOD_CAT">Category</label>
  <select name="MOD_CAT" id="MOD_CAT">
    <!-- <option value="">--Please choose a category--</option> -->
    <option value="Health">Health</option>
    <option value="Weather">Weather</option>
  </select>
  <br>
  <label for="MOD_DESC">Description</label>
  <input type="text" id="MOD_DESC" name="MOD_DESC" required minlength="4" maxlength="100" value="abcd"/>
  <br>
  <label for="MOD_URL">Url</label>
  <input type="text" id="MOD_URL" name="MOD_URL" required minlength="4" maxlength="100" value="https://github.com/khassel/dispatch_test"/>
  <br>
  <label for="TOKEN">Github-Token</label>
  <input type="text" id="TOKEN" name="TOKEN" required minlength="4" maxlength="100"/>
  <br>
  <button type="submit">submit</button>
  </form>
  <div id="status">...</div>
  <script>
  $(document).ready(function(){
    $('#myForm').submit(function (event){
      event.preventDefault();
      const json = {"event_type":"add_module",
        "client_payload":{
          "category":$('#MOD_CAT').val(),
          "description":$('#MOD_DESC').val(),
          "url":$('#MOD_URL').val()
        }
      };
      console.dir(json);
      $.ajax({
        headers: {
          "Authorization": "Bearer " + $('#TOKEN').val(),
          "Accept": "application/vnd.github+json",
          "X-GitHub-Api-Version": "2022-11-28"
        },
        url: "https://api.github.com/repos/khassel/dispatch_test/dispatches",
        data: JSON.stringify(json),
        type: "POST",
        dataType: "json",
        success: function(data) {
          document.getElementById("status").innerHTML = 'Workflow is launched, verify on <a href="https://github.com/khassel/dispatch_test/actions">Github</a>';
        },
        error: function(data) {
          document.getElementById("status").innerHTML = 'Sorry, workflow errored, for more infos check the console or visit <a href="https://github.com/khassel/dispatch_test/actions">Github</a>';
        }
      });
    });
  });
  </script>
  </body>
</html>